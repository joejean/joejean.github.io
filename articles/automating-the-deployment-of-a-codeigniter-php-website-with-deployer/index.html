<!DOCTYPE html>
<html lang="en-us">
<head>
            
                <meta name="title" content="Automating The Deployment of a Codeigniter/PHP Website with Deployer">
                <link rel="canonical" href="https://www.joejean.net/articles/automating-the-deployment-of-a-codeigniter-php-website-with-deployer/">
                <title> Automating The Deployment of a Codeigniter/PHP Website with Deployer</title>
            

        <meta charset="utf-8">
        <meta http-equiv="X-UA-COMPATIBLE" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="Joe Jean is a passionate Software Engineer. He holds a Bachelor of Science in Computer Science from New York University Abu Dhabi. JoeJean.net is his personal blog where he writes about life, technology and more.">
		<meta name="author" content="map[]">
        <link href="/atom.xml" rel="alternate" type="application/rss+xml" title="Joe Jean's Blog" />
		<meta name="robots" content="all">
		<meta name="keywords" content="coding, python, computer science, developer, programming, haitian programmer, software engineering, web development, computer programming tips, technology">
        <meta property="og:site_name" content="Joe Jean's Blog" /> 

        

        
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@joeclef509">
        <meta name="twitter:title" content="Automating The Deployment of a Codeigniter/PHP Website with Deployer" >
        <meta name="twitter:description" content="About 4 months ago, I started using some of my free time to help build Labocine.com, an amazing new platform for science cinema.  The …">
        
        
        <meta property="og:title" content="Automating The Deployment of a Codeigniter/PHP Website with Deployer" /> 
        <meta property="og:description" content="About 4 months ago, I started using some of my free time to help build Labocine.com, an amazing new platform for science cinema.  The back-end is written using the PHP framework Codeigniter. Being at …"/>
        
        


        <link rel="stylesheet" href="https://www.joejean.net/css/bootstrap.min.css"/>
		<link rel="stylesheet" href="https://www.joejean.net/css/joeblog-bootstrap.css"/>
		<link rel="stylesheet" href="https://www.joejean.net/css/font-awesome.min.css"/>
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
		<link rel="icon" href="https://www.joejean.net/images/favicon.ico" />

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/atelier-forest-dark.min.css">
		

</head>

<body>
	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand img-responsive" href="https://www.joejean.net"> <img src="https://www.joejean.net/images/joejeanlogo.png" class="img-responsive logo"/></a>
            </div>

            
            <div class="collapse navbar-collapse navbar-ex1-collapse">
              <ul class="nav navbar-nav pull-right">

                    <li class="" title="Home"><a href="/">Home</a></li>

                

                    <li class="" title="About"><a href="/about/">About</a></li>

                

                    <li class="" title="Projects"><a href="/projects/">Projects</a></li>

                
                <li><a href="https://www.joejean.net/files/Joe_Jean_Software_Engineer.pdf" target="_blank"> R&eacute;sum&eacute; </a></li>
              </ul>
            </div>
          </div>
        </nav>

    <div class="container">

	 <div class="row">
			
			
	        <div class="col-md-10">
	        
	          
	          <h1 class="text-justify">Automating The Deployment of a Codeigniter/PHP Website with Deployer</h1>
	          <p><span class="glyphicon glyphicon-user"></span> by  Joe Jean  | <span class="glyphicon glyphicon-time"></span> on January 29, 2017 |
				<span class="glyphicon glyphicon-tag"></span>  <span class="badge">php</span> <span class="badge">codeigniter</span> <span class="badge">programming</span>  </p>
	          <hr>
	          
	          <p>About 4 months ago, I started using some of my free time to help build <a href="http://labocine.com/">Labocine.com</a>, an amazing new platform for science cinema.  The back-end is written using the PHP framework <a href="https://www.codeigniter.com/">Codeigniter</a>. Being at its early stage, the site was hosted on one of those traditional hosting providers. And the deployment of new features was done using the traditional ftp approach. After joining the project and as it grew, I decided to host it on a VPS and automate the deployment process. My goal for this post is to show you how you can easily automate the deployment of your Codeigniter web application, or any PHP web application for that matter.</p>

<p>Before we can proceed, you need to make sure of two things. First, your project needs to be version controlled and available on a git hosting service such as Github, Bitbucket or Gitlab. Second, you need to have ssh access to the server where your application is (to be) hosted.</p>

<p>The deployment tool we are going to use is called <a href="https://deployer.org/">Deployer</a>. Let&rsquo;s start by installing it in our Codeigniter project. I recommend using composer for the installation. Assuming you have composer installed on your computer, run the following command in the root of your project repository.
<pre><code class="php">
    composer require-dev deployer/deployer
</code></pre></p>

<p>You should now have a <code>bin</code> folder along with a <code>deployer</code> folder inside the <code>vendor</code> folder in your application root.</p>

<p>Now, while still in the root of the project repository, let&rsquo;s create a file called <code>deploy.php</code>. This file, called a <code>recipe</code>,  will contain the custom deployment configurations that Deployer will be relying upon to deploy your application. Following is an example <code>deploy.php</code>.</p>

<pre><code class="php7">
require 'recipe/codeigniter.php';
set('default_stage', 'live');
server('SERVER_NAME', 'SERVER_IP_ADDRESS')
    ->identityFile()
    ->user('YOUR_USERNAME_ON_SERVER')
    ->stage('live')
    ->env('deploy_path', '/var/www/html/app');
 set('repository', '-b branch-name git@github.com:test/SAMPLEREPO.git');
</code></pre>

<p>Now let&rsquo;s go over the content of <code>deploy.php</code>. Since we are going to deploy a Codeigniter application , our <code>deploy.php</code> recipe needs to extend the Codeigniter recipe, and this is what we do in the second line. If you are using another framework, you can find the list of all the supported recipes <a href="https://github.com/deployphp/deployer/tree/master/recipe">here</a>.
On the 3rd line, we set the default stage. The stage is more like an environment and in our case we set it to <code>live</code>. So, your stage could be development, staging etc. Next, we configure our server where our code will be deployed. We give the server a name, any name we want, and we provide its IP address. In the following line, we use <code>identityFile()</code> to tell Deployer that we want to connect to our server using ssh and the ssh keys are located in our <code>.ssh</code> folder. If your keys are located somewhere else or if they were created with a password you can still pass the the full path to your keys as follows:</p>

<pre><code class="php">
identityFile("~/path_to_ssh_folder/id_rsa.pub","~/path_to_ssh_folder/id_rsa", "pass phrase");
</code></pre>

<p>You can also configure Deployer to log into your server using a username and password, please see <a href="https://deployer.org/docs/servers">the documentation</a> for an example on how to do that. In the next 3 lines we pass it the username with which to ssh into our server, we tie this server to a stage which is the default stage in this case, and we provide the path where our application should be deployed. The last thing we need to do is to  specify the git repository which contains the code to be deployed. It is important to note that in this example we are using one server, but you can configure however many servers you want in your <code>deploy.php</code>.</p>

<p>Now we are ready to deploy our app. In order to do so we just need to type, while in the root of our project,
<pre><code>php vendor/bin/dep deploy live</code></pre> or
<pre><code>php vendor/bin/dep deploy SERVER_NAME</code></pre> Since we set the default stage to <code>live</code>, we can also just do <code>php vendor/bin/dep deploy</code>.</p>

<p>After deploying, if something breaks, rolling back to the previous working version of your site is as easy as <pre><code>php vendor/bin/dep rollback live </code></pre></p>

<p>Imagine you create a new branch, work on it, commit and push your changes. In order to deploy those changes, you need to manually go into the <code>deploy.php</code> file and change the branch name in the last line: <pre><code>set(&lsquo;repository&rsquo;, &lsquo;-b branch-name git@github.com:test/SAMPLEREPO.git&rsquo;);</code></pre>This is a bit tedious, isn&rsquo;t it? Instead, we can just create a pre-commit hook that will go and make that change for us every time we commit. Here is what my <code>.git/hooks/pre-commit</code> looks like:</p>

<pre><code class="bash">
branch=$(git branch | sed -n -e 's/^\* \(.*\)/\1/p')
sed -i '$ d' deploy.php
echo "set('repository', '-b $branch git@github.com:test/SAMPLEREPO.git');">> deploy.php
git add deploy.php
</code></pre>

<p>With something like that in place, I do not need to manually edit the <code>deploy.php</code>  every time I want to deploy a new branch. After a <code>git push</code> I can do a <code>dep deploy</code> and be sure that my latest changes on my new branch will get deployed.</p>

<p>If you use Deployer in some other interesting ways, or if you use other tools for your deployment, please feel free to leave a comment below.</p>

	          
	          
	          
	          <div class="well">
	            <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "joejeanblog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> 

	          </div>
	 </div>






        <footer>
			<div class="row">
			  <div class="col-md-12">
			    <hr class="btn-custom">
                <p class="text-center center-block">
                    <a href="https://www.facebook.com/joe.jean3"><i class="fa fa-facebook-square fa-2x"></i></a>
                    <a href="https://ae.linkedin.com/in/joejean/"><i class="fa fa-linkedin-square fa-2x"></i></a>
                       <a href="https://google.com/+JoeJean"><i class="fa fa-google-plus fa-2x"></i> </a>
                       <a href="https://github.com/joejean"><i class="fa fa-github fa-2x"></i></a>
                      <a href="mailto:joe@joejean.info"><i class="fa fa-envelope fa-2x"></i></a>
                </p>
				<p class="text-center center-block"> &copy; 2014-<span id="current_year"></span>
                  
				
				</p>
				<br >
			  </div>
			</div>
		</footer>
	</div>

        
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-46696882-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

		
		 
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-58bed897fcf4597c"></script> 
		<script type="text/javascript">
		  addthis.layers({
			'theme' : 'transparent',
			'share' : {
			  'position' : 'left',
			  'numPreferredServices' : 4
			}
		  });
		</script>
		


	
    <script src="https://www.joejean.net/js/jquery-1.10.2.min.js"></script>
    <script src="https://www.joejean.net/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

    
	<script>hljs.initHighlightingOnLoad();</script>
    <script type="text/javascript">
        $('#current_year').text((new Date()).getFullYear());
    </script>
</body>
</html>
